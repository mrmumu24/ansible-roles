- name: check if worker node is part of the cluster
  stat:
    path: /etc/kubernetes/kubelet.conf
  register: kubelet_conf
  when: "'workers' in group_names"

- name: create join command
  shell: kubeadm token create --print-join-command
  register: join_command
  delegate_to: master1
  run_once: true

- name: join workers to the cluster
  shell: "{{ join_command.stdout }}"
  when:
    - "'workers' in group_names"
    - not kubelet_conf.stat.exists
